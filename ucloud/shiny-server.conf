# Sample Shiny-Server Configuration for Time Tracking App
# Copy this to /etc/shiny-server/shiny-server.conf or merge with existing config
#
# For more info: https://docs.posit.co/shiny-server/

# Define the user we should use when spawning R Shiny processes
run_as shiny;

# Define a top-level server which will listen on port 3838
server {
  listen 3838;

  # Define the location available at the base URL
  location / {
    site_dir /srv/shiny-server;

    # Log all Shiny output to files in this directory
    log_dir /var/log/shiny-server;

    # When a user visits the base URL rather than a particular application,
    # an index of the applications available in this directory will be shown.
    directory_index on;
  }

  # Time Tracking App specific configuration
  location /time-tracking {
    # Path to the time tracking application
    app_dir /srv/shiny-server/time-tracking-app;

    # Log directory for this app
    log_dir /var/log/shiny-server;

    # Increase idle timeout to 10 minutes (default is 5)
    # Users won't be disconnected during longer time tracking sessions
    app_idle_timeout 600;

    # Increase init timeout to 2 minutes for authentication setup
    app_init_timeout 120;

    # Simple scheduler: limit concurrent sessions to 10
    # Adjust based on your server resources
    simple_scheduler 10;

    # Preserve logs for debugging
    preserve_logs true;

    # Optional: Run as specific user (uncomment if needed)
    # run_as username;

    # Optional: Disable directory index for this app
    directory_index off;
  }
}

# Alternative: Dedicated server for time tracking on different port
# Uncomment this section if you want the app on its own port (e.g., 3839)
#
# server {
#   listen 3839;
#
#   location / {
#     app_dir /srv/shiny-server/time-tracking-app;
#     log_dir /var/log/shiny-server;
#     app_idle_timeout 600;
#     app_init_timeout 120;
#     simple_scheduler 10;
#   }
# }

# Admin dashboard (optional)
# Provides monitoring and management interface
# Access at http://server:4151
admin 4151 {
  # Require authentication for admin interface
  required_user shiny;
}
